<!doctype html><html lang=zn-Hans><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge, chrome=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no,maximum-scale=1"><meta name=author content="Desdemo"><meta name=description content="Go设计模式-责任链模式"><meta property="og:title" content="Go设计模式-责任链模式"><meta property="og:description" content="Go设计模式-责任链模式"><meta property="og:type" content="article"><meta property="og:url" content="https://desdemo.top/moment/%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/"><meta property="article:section" content="moment"><meta property="article:published_time" content="2024-01-19T15:04:57+08:00"><meta property="article:modified_time" content="2024-01-19T15:04:57+08:00"><title>Go设计模式-责任链模式 | Desdemo
</title><link rel=canonical href=https://desdemo.top/moment/%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/><link href=https://desdemo.top/vendors/fontawesome-free-5.14.0-web/css/all.min.css rel=stylesheet><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Ubuntu+Mono:400,400i,700,700i|Raleway:300,400,500,600"><link href=https://desdemo.top/css/font.css rel=stylesheet><link href=https://desdemo.top/css/vendors/bootstrap4/bootstrap.min.css rel=stylesheet><link href=https://desdemo.top/css/vendors-extensions/mdb/mdb.min.css rel=stylesheet><link href=https://desdemo.top/css/vendors/mdb/style.min.css rel=stylesheet><link href=https://desdemo.top/css/main.css rel=stylesheet><link rel="shortcut icon" href=https://desdemo.top/image/logo.png><style type=text/css>@media(min-width:800px) and (max-width:850px){.navbar:not(.top-nav-collapse){background:#1c2331!important}}</style><link rel=stylesheet href=https://desdemo.top/js/vendors/katex/katex.min.css><link rel=stylesheet href=https://desdemo.top/css/vendors/highlight/github-gist.css></head><body class=bg-light data-spy=scroll data-target=#page-scrollspy data-offset=90><nav class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class=container><a class=navbar-brand href=https://desdemo.top/><img class=avatar src=https://desdemo.top/image/logo.png style=width:40px!important;height:auto class="d-inline-block align-top" alt>
<strong>Desdemo</strong>
</a><button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=https://desdemo.top/>Home</a></li><li class=nav-item><a class=nav-link href=https://desdemo.top/blog/>Blog</a></li><li class=nav-item><a class=nav-link href=https://desdemo.top/moment/>Moment</a></li><li class=nav-item><a class=nav-link href=https://desdemo.top/about/>About</a></li></ul></div></div></nav><div id=site-header class="carousel slide carousel-fade" data-ride=carousel style=height:18rem><div class=carousel-inner role=listbox><div class="carousel-item active"><div class=view style=background-image:url(https://desdemo.top/image/header-slides/20210228110118.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div><div class=carousel-item><div class=view style=background-image:url(https://desdemo.top/image/header-slides//%e5%be%ae%e4%bf%a1%e5%9b%be%e7%89%87_20210901164615-min.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div><div class=carousel-item><div class=view style=background-image:url(https://desdemo.top/image/header-slides//%e5%be%ae%e4%bf%a1%e5%9b%be%e7%89%87_20210901164624%20%281%29.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div><div class=carousel-item><div class=view style=background-image:url(https://desdemo.top/image/header-slides//%e5%be%ae%e4%bf%a1%e5%9b%be%e7%89%87_20210901164643-min.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div><div class=carousel-item><div class=view style=background-image:url(https://desdemo.top/image/header-slides//%e5%be%ae%e4%bf%a1%e5%9b%be%e7%89%87_20210901164655.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div><div class=carousel-item><div class=view style=background-image:url(https://desdemo.top/image/header-slides//%e5%be%ae%e4%bf%a1%e5%9b%be%e7%89%87_20230221150156.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div><div class=carousel-item><div class=view style=background-image:url(https://desdemo.top/image/header-slides//%e5%be%ae%e4%bf%a1%e5%9b%be%e7%89%87_202302211501561.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div></div><div class="carousel-content text-center white-text wow fadeIn"><div class="row mx-0 headfont mt-3 pt-4"><div class="col-12 col-sm-5 align-middle"><a href=https://desdemo.top/><img class="pull-right avatar avatar-md" src=https://desdemo.top/image/pro.jpg alt></a></div><div class="col-12 col-sm-7 text-left pl-2"><a href=https://desdemo.top/><h1 class="mb-2 h1" style=font-weight:300><strong>Desdemo</strong></h1></a><div class=mt-2 style=font-size:1rem;color:#fff><a href=//github.com/desdemo target=_blank rel="noopener me"><i class="fab fa-github pr-1" aria-hidden=true></i></a>
<a href=mailto:guodesdemo@gmail.com><i class="far fa-envelope-open pr-1" aria-hidden=true></i></a></div></div></div></div></div><main class=post-main-wrapper><div class=row><div class=col-md-10><div class="z-depth-1 post-wrapper white-bg single-post dont-break-out"><div class="post-header text-center"><ul class="post-meta li-x"><li><a href=https://desdemo.top/categories/%E6%8A%80%E6%9C%AF><i class="fas fa-folder-open pr-1" aria-hidden=true></i> 技术</a></li><li><a href=https://desdemo.top/series/golang%E6%8E%A2%E7%B4%A2><i class="fas fa-bookmark pr-1" aria-hidden=true></i>golang探索</a></li></ul><div class="px-4 post-heading">Go设计模式-责任链模式</div><ul class="post-meta li-x mt-1"><li>Jan 19, 2024</li><li class=middot></li><li>3 minute read</li></ul></div><div class="post-content markdown"><p>原文链接:https://tigerb.cn/go/#/patterns/responsiblity</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;runtime&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Context Context
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Context</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Handler 处理
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Handler</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 自身的业务
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nf>Do</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=kt>error</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 设置下一个对象
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nf>SetNext</span><span class=p>(</span><span class=nx>h</span> <span class=nx>Handler</span><span class=p>)</span> <span class=nx>Handler</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 执行
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nf>Run</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=kt>error</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Next 抽象出来的 可被合成复用的结构体
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Next</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 下一个对象
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>nextHandler</span> <span class=nx>Handler</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// SetNext 实现好的 可被复用的SetNext方法
</span></span></span><span class=line><span class=cl><span class=c1>// 返回值是下一个对象 方便写成链式代码优雅
</span></span></span><span class=line><span class=cl><span class=c1>// 例如 nullHandler.SetNext(argumentsHandler).SetNext(signHandler).SetNext(frequentHandler)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>n</span> <span class=o>*</span><span class=nx>Next</span><span class=p>)</span> <span class=nf>SetNext</span><span class=p>(</span><span class=nx>h</span> <span class=nx>Handler</span><span class=p>)</span> <span class=nx>Handler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>n</span><span class=p>.</span><span class=nx>nextHandler</span> <span class=p>=</span> <span class=nx>h</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>h</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Run 执行
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>n</span> <span class=o>*</span><span class=nx>Next</span><span class=p>)</span> <span class=nf>Run</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>err</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 由于go无继承的概念 这里无法执行当前handler的Do
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// n.Do(c)
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>if</span> <span class=nx>n</span><span class=p>.</span><span class=nx>nextHandler</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>// 合成复用下的变种
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=c1>// 执行下一个handler的Do
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>if</span> <span class=nx>err</span> <span class=p>=</span> <span class=p>(</span><span class=nx>n</span><span class=p>.</span><span class=nx>nextHandler</span><span class=p>).</span><span class=nf>Do</span><span class=p>(</span><span class=nx>c</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=c1>// 执行下一个handler的Run
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>return</span> <span class=p>(</span><span class=nx>n</span><span class=p>.</span><span class=nx>nextHandler</span><span class=p>).</span><span class=nf>Run</span><span class=p>(</span><span class=nx>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// NullHandler 空Handler
</span></span></span><span class=line><span class=cl><span class=c1>// 由于go无继承的概念 作为链式调用的第一个载体 设置实际的下一个对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>NullHandler</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 合成复用Next的`nextHandler`成员属性、`SetNext`成员方法、`Run`成员方法
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>Next</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Do 空Handler的Do
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>NullHandler</span><span class=p>)</span> <span class=nf>Do</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>err</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 空Handler 这里什么也不做 只是载体 do nothing...
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>return</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ArgumentsHandler 校验参数的handler
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>ArgumentsHandler</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 合成复用Next
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>Next</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Do 校验参数的逻辑
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>ArgumentsHandler</span><span class=p>)</span> <span class=nf>Do</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>err</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nf>runFuncName</span><span class=p>(),</span> <span class=s>&#34;校验参数成功...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// AddressInfoHandler 地址信息handler
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>AddressInfoHandler</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 合成复用Next
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>Next</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Do 校验参数的逻辑
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>AddressInfoHandler</span><span class=p>)</span> <span class=nf>Do</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>err</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nf>runFuncName</span><span class=p>(),</span> <span class=s>&#34;获取地址信息...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nf>runFuncName</span><span class=p>(),</span> <span class=s>&#34;地址信息校验...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// CartInfoHandler 获取购物车数据handler
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>CartInfoHandler</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 合成复用Next
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>Next</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Do 校验参数的逻辑
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>CartInfoHandler</span><span class=p>)</span> <span class=nf>Do</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>err</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nf>runFuncName</span><span class=p>(),</span> <span class=s>&#34;获取购物车数据...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// StockInfoHandler 商品库存handler
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>StockInfoHandler</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 合成复用Next
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>Next</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Do 校验参数的逻辑
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>StockInfoHandler</span><span class=p>)</span> <span class=nf>Do</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>err</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nf>runFuncName</span><span class=p>(),</span> <span class=s>&#34;获取商品库存信息...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nf>runFuncName</span><span class=p>(),</span> <span class=s>&#34;商品库存校验...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// PromotionInfoHandler 获取优惠信息handler
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>PromotionInfoHandler</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 合成复用Next
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>Next</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Do 校验参数的逻辑
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>PromotionInfoHandler</span><span class=p>)</span> <span class=nf>Do</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>err</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nf>runFuncName</span><span class=p>(),</span> <span class=s>&#34;获取优惠信息...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ShipmentInfoHandler 获取运费信息handler
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>ShipmentInfoHandler</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 合成复用Next
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>Next</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Do 校验参数的逻辑
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>ShipmentInfoHandler</span><span class=p>)</span> <span class=nf>Do</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>err</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nf>runFuncName</span><span class=p>(),</span> <span class=s>&#34;获取运费信息...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// PromotionUseHandler 使用优惠信息handler
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>PromotionUseHandler</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 合成复用Next
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>Next</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Do 校验参数的逻辑
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>PromotionUseHandler</span><span class=p>)</span> <span class=nf>Do</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>err</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nf>runFuncName</span><span class=p>(),</span> <span class=s>&#34;使用优惠信息...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// StockSubtractHandler 库存操作handler
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>StockSubtractHandler</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 合成复用Next
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>Next</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Do 校验参数的逻辑
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>StockSubtractHandler</span><span class=p>)</span> <span class=nf>Do</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>err</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nf>runFuncName</span><span class=p>(),</span> <span class=s>&#34;扣库存...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// CartDelHandler 清理购物车handler
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>CartDelHandler</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 合成复用Next
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>Next</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Do 校验参数的逻辑
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>CartDelHandler</span><span class=p>)</span> <span class=nf>Do</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>err</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nf>runFuncName</span><span class=p>(),</span> <span class=s>&#34;清理购物车...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1>// err = fmt.Errorf(&#34;CartDelHandler.Do fail&#34;)
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>return</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// DBTableOrderHandler 写订单表handler
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>DBTableOrderHandler</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 合成复用Next
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>Next</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Do 校验参数的逻辑
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>DBTableOrderHandler</span><span class=p>)</span> <span class=nf>Do</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>err</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nf>runFuncName</span><span class=p>(),</span> <span class=s>&#34;写订单表...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// DBTableOrderSkusHandler 写订单商品表handler
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>DBTableOrderSkusHandler</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 合成复用Next
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>Next</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Do 校验参数的逻辑
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>DBTableOrderSkusHandler</span><span class=p>)</span> <span class=nf>Do</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>err</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nf>runFuncName</span><span class=p>(),</span> <span class=s>&#34;写订单商品表...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// DBTableOrderPromotionsHandler 写订单优惠信息表handler
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>DBTableOrderPromotionsHandler</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 合成复用Next
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>Next</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Do 校验参数的逻辑
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>DBTableOrderPromotionsHandler</span><span class=p>)</span> <span class=nf>Do</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>err</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nf>runFuncName</span><span class=p>(),</span> <span class=s>&#34;写订单优惠信息表...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 获取正在运行的函数名
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>runFuncName</span><span class=p>()</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>pc</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>([]</span><span class=kt>uintptr</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>runtime</span><span class=p>.</span><span class=nf>Callers</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=nx>pc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>f</span> <span class=o>:=</span> <span class=nx>runtime</span><span class=p>.</span><span class=nf>FuncForPC</span><span class=p>(</span><span class=nx>pc</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>f</span><span class=p>.</span><span class=nf>Name</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 初始化空handler
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>nullHandler</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>NullHandler</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// 链式调用 代码是不是很优雅
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// 很明显的链 逻辑关系一览无余
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>nullHandler</span><span class=p>.</span><span class=nf>SetNext</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>ArgumentsHandler</span><span class=p>{}).</span>
</span></span><span class=line><span class=cl>		<span class=nf>SetNext</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>AddressInfoHandler</span><span class=p>{}).</span>
</span></span><span class=line><span class=cl>		<span class=nf>SetNext</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>CartInfoHandler</span><span class=p>{}).</span>
</span></span><span class=line><span class=cl>		<span class=nf>SetNext</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>StockInfoHandler</span><span class=p>{}).</span>
</span></span><span class=line><span class=cl>		<span class=nf>SetNext</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>PromotionInfoHandler</span><span class=p>{}).</span>
</span></span><span class=line><span class=cl>		<span class=nf>SetNext</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>ShipmentInfoHandler</span><span class=p>{}).</span>
</span></span><span class=line><span class=cl>		<span class=nf>SetNext</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>PromotionUseHandler</span><span class=p>{}).</span>
</span></span><span class=line><span class=cl>		<span class=nf>SetNext</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>StockSubtractHandler</span><span class=p>{}).</span>
</span></span><span class=line><span class=cl>		<span class=nf>SetNext</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>CartDelHandler</span><span class=p>{}).</span>
</span></span><span class=line><span class=cl>		<span class=nf>SetNext</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>DBTableOrderHandler</span><span class=p>{}).</span>
</span></span><span class=line><span class=cl>		<span class=nf>SetNext</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>DBTableOrderSkusHandler</span><span class=p>{}).</span>
</span></span><span class=line><span class=cl>		<span class=nf>SetNext</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>DBTableOrderPromotionsHandler</span><span class=p>{})</span>
</span></span><span class=line><span class=cl>	<span class=c1>//无限扩展代码...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>	<span class=c1>// 开始执行业务
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>nullHandler</span><span class=p>.</span><span class=nf>Run</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>Context</span><span class=p>{});</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>// 异常
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Fail | Error:&#34;</span> <span class=o>+</span> <span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>())</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 成功
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Success&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></div><div class=row><div class=col-md-8></div></div><div class="row pt-3"><div class=col-md-6><a href=https://desdemo.top/moment/%E9%99%90%E6%B5%81/ class=post-meta>Previous<div class="pt-2 pb-5 d-flex"><i class="fas fa-angle-left text-grey font-weight-bold mr-2 active-color"></i>
<span>限流Code</span></div></a></div><div class="col-md-6 text-right"></div></div></div></div></div></main><footer class="page-footer text-center font-small mt-4 wow fadeIn"><div class="pb-2 mt-5 pt-5"><a href=//github.com/desdemo target=_blank rel="noopener me"><i class="fab fa-github pr-1" aria-hidden=true></i></a>
<a href=mailto:guodesdemo@gmail.com><i class="far fa-envelope-open pr-1" aria-hidden=true></i></a></div><div class="copyright py-4"><span>2016 - 2024 &copy; | Theme <a href=https://github.com/EliiseS/AllinOne target=_blank>AllinOne</a></span></div></footer><script type=text/javascript src=https://desdemo.top/js/vendors/jquery/jquery-3.3.1.min.js></script><script type=text/javascript src=https://desdemo.top/js/vendors/jquery/jquery.smooth-scroll.min.js></script><script type=text/javascript src=https://desdemo.top/js/vendors/popper.min.js></script><script type=text/javascript src=https://desdemo.top/js/vendors/holder.min.js></script><script type=text/javascript src=https://desdemo.top/js/vendors-extensions/bootstrap4/bootstrap.min.js></script><script type=text/javascript src=https://desdemo.top/js/vendors/mdb/mdb.min.js></script><script type=text/javascript src=https://desdemo.top/js/main.js></script><script src=https://desdemo.top/js/vendors/highlight.pack.js></script><script>hljs.initHighlightingOnLoad()</script><script src=https://desdemo.top/js/vendors/katex/katex.min.js></script><script src=https://desdemo.top/js/vendors/katex/contrib/auto-render.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body)})</script><script type=text/javascript>(new WOW).init()</script></body></html>