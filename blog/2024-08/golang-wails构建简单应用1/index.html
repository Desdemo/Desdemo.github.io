<!doctype html><html lang=zn-Hans><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge, chrome=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no,maximum-scale=1"><meta name=author content="Desdemo"><meta name=description content="使用wails构建应用的尝试"><meta property="og:title" content="Golang Wails构建简单应用(1)"><meta property="og:description" content="使用wails构建应用的尝试"><meta property="og:type" content="article"><meta property="og:url" content="https://desdemo.top/blog/2024-08/golang-wails%E6%9E%84%E5%BB%BA%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A81/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2024-08-05T11:46:47+08:00"><meta property="article:modified_time" content="2024-08-05T11:46:47+08:00"><title>Golang Wails构建简单应用(1) | Desdemo
</title><link rel=canonical href=https://desdemo.top/blog/2024-08/golang-wails%E6%9E%84%E5%BB%BA%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A81/><link href=https://desdemo.top/vendors/fontawesome-free-5.14.0-web/css/all.min.css rel=stylesheet><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Ubuntu+Mono:400,400i,700,700i|Raleway:300,400,500,600"><link href=https://desdemo.top/css/font.css rel=stylesheet><link href=https://desdemo.top/css/vendors/bootstrap4/bootstrap.min.css rel=stylesheet><link href=https://desdemo.top/css/vendors-extensions/mdb/mdb.min.css rel=stylesheet><link href=https://desdemo.top/css/vendors/mdb/style.min.css rel=stylesheet><link href=https://desdemo.top/css/main.css rel=stylesheet><link rel="shortcut icon" href=https://desdemo.top/image/logo.png><style type=text/css>@media(min-width:800px) and (max-width:850px){.navbar:not(.top-nav-collapse){background:#1c2331!important}}</style><link rel=stylesheet href=https://desdemo.top/js/vendors/katex/katex.min.css><link rel=stylesheet href=https://desdemo.top/css/vendors/highlight/github-gist.css></head><body class=bg-light data-spy=scroll data-target=#page-scrollspy data-offset=90><nav class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class=container><a class=navbar-brand href=https://desdemo.top><img class=avatar src=https://desdemo.top/image/logo.png style=width:40px!important;height:auto class="d-inline-block align-top" alt>
<strong>Desdemo</strong>
</a><button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=https://desdemo.top>Home</a></li><li class=nav-item><a class=nav-link href=https://desdemo.top/blog/>Blog</a></li><li class=nav-item><a class=nav-link href=https://desdemo.top/moment/>Moment</a></li><li class=nav-item><a class=nav-link href=https://desdemo.top/about/>About</a></li></ul></div></div></nav><div id=site-header class="carousel slide carousel-fade" data-ride=carousel style=height:18rem><div class=carousel-inner role=listbox><div class="carousel-item active"><div class=view style=background-image:url(https://desdemo.top/image/header-slides/20210228110118.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div><div class=carousel-item><div class=view style=background-image:url(https://desdemo.top/image/header-slides//%e5%be%ae%e4%bf%a1%e5%9b%be%e7%89%87_20210901164615-min.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div><div class=carousel-item><div class=view style=background-image:url(https://desdemo.top/image/header-slides//%e5%be%ae%e4%bf%a1%e5%9b%be%e7%89%87_20210901164624%20%281%29.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div><div class=carousel-item><div class=view style=background-image:url(https://desdemo.top/image/header-slides//%e5%be%ae%e4%bf%a1%e5%9b%be%e7%89%87_20210901164643-min.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div><div class=carousel-item><div class=view style=background-image:url(https://desdemo.top/image/header-slides//%e5%be%ae%e4%bf%a1%e5%9b%be%e7%89%87_20210901164655.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div><div class=carousel-item><div class=view style=background-image:url(https://desdemo.top/image/header-slides//%e5%be%ae%e4%bf%a1%e5%9b%be%e7%89%87_20230221150156.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div><div class=carousel-item><div class=view style=background-image:url(https://desdemo.top/image/header-slides//%e5%be%ae%e4%bf%a1%e5%9b%be%e7%89%87_202302211501561.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div></div><div class="carousel-content text-center white-text wow fadeIn"><div class="row mx-0 headfont mt-3 pt-4"><div class="col-12 col-sm-5 align-middle"><a href=https://desdemo.top><img class="pull-right avatar avatar-md" src=https://desdemo.top/image/pro.jpg alt></a></div><div class="col-12 col-sm-7 text-left pl-2"><a href=https://desdemo.top><h1 class="mb-2 h1" style=font-weight:300><strong>Desdemo</strong></h1></a><div class=mt-2 style=font-size:1rem;color:#fff><a href=//github.com/desdemo target=_blank rel="noopener me"><i class="fab fa-github pr-1" aria-hidden=true></i></a>
<a href=mailto:guodesdemo@gmail.com><i class="far fa-envelope-open pr-1" aria-hidden=true></i></a></div></div></div></div></div><main class=post-main-wrapper><div class=row><div class=col-md-10><div class="z-depth-1 post-wrapper white-bg single-post dont-break-out"><div class="post-header text-center"><ul class="post-meta li-x"><li><a href=https://desdemo.top/categories/%E6%8A%80%E6%9C%AF><i class="fas fa-folder-open pr-1" aria-hidden=true></i> 技术</a></li><li><a href=https://desdemo.top/series/golang%E6%8E%A2%E7%B4%A2><i class="fas fa-bookmark pr-1" aria-hidden=true></i>Golang探索</a></li></ul><div class="px-4 post-heading">Golang Wails构建简单应用(1)</div><ul class="post-meta li-x mt-1"><li>Aug 5, 2024</li><li class=middot></li><li>3 minute read</li></ul></div><div class="post-content markdown"><h1 id=安装>安装</h1><p>某天通过v2了解到了golang编写的redis<a href=https://github.com/tiny-craft/tiny-rdm>客户端</a>，感觉很奇妙，没想到可以这样构建应用，正好有简单需求，所以想起来这个，于是简单尝试了一下。</p><p>首先通过官网的指引，一步步的进行安装。前置依赖需要golang 和 Node，然后直接<code>go install github.com/wailsapp/wails/v2/cmd/wails@latest</code>安装就行</p><p>要注意golang的环境变量配置，不然可能找不到。</p><p>安装完成后，需要执行下 <code>wails doctor</code>，检查下相关的依赖和环境。</p><h1 id=运行>运行</h1><p>使用命令<code>wails init -n myproject -t vue-ts</code></p><p>也可以使用第三方模板进行初始化<code>wails init -n &lt;Your Appname> -t https://github.com/misitebao/wails-template-vue[@version]</code></p><p>如果需要调试的话，创建项目的时候可以加上<code>wails init -n yourProject --ide goland</code></p><p>这里，我使用最简单的方式构建一下<code>wails init -n MyJob -t vue-ts --ide goland</code></p><p>开发运行的话使用 <code>wails dev</code></p><p>构建项目使用<code>wails build</code></p><h1 id=需求群发邮箱>需求:群发邮箱</h1><p>1 使用<code>smtp</code>发送邮件</p><p>2 使用<code>imap</code>保存邮件</p><p>3 根据文件读取发件人和附件</p><p>首先创建邮件,在<code>app.go</code>中创建函数</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>createEmail</span><span class=p>(</span><span class=nx>to</span><span class=p>,</span> <span class=nx>cc</span><span class=p>,</span> <span class=nx>bcc</span> <span class=p>[]</span><span class=kt>string</span><span class=p>,</span> <span class=nx>attachmentPath</span> <span class=kt>string</span><span class=p>)</span> <span class=p>[]</span><span class=kt>byte</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>b</span> <span class=nx>bytes</span><span class=p>.</span><span class=nx>Buffer</span>
</span></span><span class=line><span class=cl>	<span class=nx>writer</span> <span class=o>:=</span> <span class=nx>multipart</span><span class=p>.</span><span class=nf>NewWriter</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>smtpUser</span> <span class=o>:=</span> <span class=s>&#34;user@user.com&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>subject</span> <span class=o>:=</span> <span class=nf>GetFileName</span><span class=p>(</span><span class=nx>attachmentPath</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>body</span> <span class=o>:=</span> <span class=s>`&lt;!DOCTYPE html&gt;
</span></span></span><span class=line><span class=cl><span class=s>&lt;html lang=&#34;zh&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=s>&lt;head&gt;
</span></span></span><span class=line><span class=cl><span class=s>    &lt;meta charset=&#34;UTF-8&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=s>    &lt;meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1.0&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=s>    &lt;title&gt;月度账单通知&lt;/title&gt;
</span></span></span><span class=line><span class=cl><span class=s>    &lt;style&gt;
</span></span></span><span class=line><span class=cl><span class=s>        body {
</span></span></span><span class=line><span class=cl><span class=s>            font-family: Arial, sans-serif;
</span></span></span><span class=line><span class=cl><span class=s>            line-height: 1.6;
</span></span></span><span class=line><span class=cl><span class=s>        }
</span></span></span><span class=line><span class=cl><span class=s>        .indent {
</span></span></span><span class=line><span class=cl><span class=s>            text-indent: 2em; /* 缩进 2em */
</span></span></span><span class=line><span class=cl><span class=s>        }
</span></span></span><span class=line><span class=cl><span class=s>        .section {
</span></span></span><span class=line><span class=cl><span class=s>            margin-bottom: 1em; /* 段落间距 */
</span></span></span><span class=line><span class=cl><span class=s>        }
</span></span></span><span class=line><span class=cl><span class=s>        .redfont {
</span></span></span><span class=line><span class=cl><span class=s>            color: red;
</span></span></span><span class=line><span class=cl><span class=s>        }
</span></span></span><span class=line><span class=cl><span class=s>    &lt;/style&gt;
</span></span></span><span class=line><span class=cl><span class=s>&lt;/head&gt;
</span></span></span><span class=line><span class=cl><span class=s>&lt;body&gt;
</span></span></span><span class=line><span class=cl><span class=s>&lt;p&gt;尊敬的合作伙伴：&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=s>&lt;p class=&#34;indent&#34;&gt;大家好！&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=s>&lt;br&gt;
</span></span></span><span class=line><span class=cl><span class=s>&lt;p class=&#34;indent&#34;&gt;顺颂商祺。&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=s>&lt;/body&gt;
</span></span></span><span class=line><span class=cl><span class=s>&lt;/html&gt;
</span></span></span><span class=line><span class=cl><span class=s>			`</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 写入邮件头
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>header</span> <span class=o>:=</span> <span class=nx>textproto</span><span class=p>.</span><span class=nx>MIMEHeader</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>	<span class=nx>header</span><span class=p>.</span><span class=nf>Set</span><span class=p>(</span><span class=s>&#34;From&#34;</span><span class=p>,</span> <span class=nx>smtpUser</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>header</span><span class=p>.</span><span class=nf>Set</span><span class=p>(</span><span class=s>&#34;To&#34;</span><span class=p>,</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>Join</span><span class=p>(</span><span class=nx>to</span><span class=p>,</span> <span class=s>&#34;, &#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=nx>cc</span><span class=p>)</span> <span class=p>&gt;</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>header</span><span class=p>.</span><span class=nf>Set</span><span class=p>(</span><span class=s>&#34;Cc&#34;</span><span class=p>,</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>Join</span><span class=p>(</span><span class=nx>cc</span><span class=p>,</span> <span class=s>&#34;, &#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>header</span><span class=p>.</span><span class=nf>Set</span><span class=p>(</span><span class=s>&#34;Subject&#34;</span><span class=p>,</span> <span class=nx>subject</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>header</span><span class=p>.</span><span class=nf>Set</span><span class=p>(</span><span class=s>&#34;MIME-Version&#34;</span><span class=p>,</span> <span class=s>&#34;1.0&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>header</span><span class=p>.</span><span class=nf>Set</span><span class=p>(</span><span class=s>&#34;Content-Type&#34;</span><span class=p>,</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;multipart/mixed; boundary=%s&#34;</span><span class=p>,</span> <span class=nx>writer</span><span class=p>.</span><span class=nf>Boundary</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>k</span><span class=p>,</span> <span class=nx>v</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>header</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Fprintf</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>b</span><span class=p>,</span> <span class=s>&#34;%s: %s\r\n&#34;</span><span class=p>,</span> <span class=nx>k</span><span class=p>,</span> <span class=nx>v</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>b</span><span class=p>.</span><span class=nf>WriteString</span><span class=p>(</span><span class=s>&#34;\r\n&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// 写入邮件正文
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>part</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nx>writer</span><span class=p>.</span><span class=nf>CreatePart</span><span class=p>(</span><span class=nx>textproto</span><span class=p>.</span><span class=nx>MIMEHeader</span><span class=p>{</span><span class=s>&#34;Content-Type&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s>&#34;text/html&#34;</span><span class=p>}})</span>
</span></span><span class=line><span class=cl>	<span class=nx>part</span><span class=p>.</span><span class=nf>Write</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>body</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// 添加附件
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>attachment</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>ReadFile</span><span class=p>(</span><span class=nx>attachmentPath</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>log</span><span class=p>.</span><span class=nf>Fatal</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>part</span><span class=p>,</span> <span class=nx>_</span> <span class=p>=</span> <span class=nx>writer</span><span class=p>.</span><span class=nf>CreatePart</span><span class=p>(</span><span class=nx>textproto</span><span class=p>.</span><span class=nx>MIMEHeader</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=s>&#34;Content-Type&#34;</span><span class=p>:</span>              <span class=p>{</span><span class=s>&#34;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=s>&#34;Content-Transfer-Encoding&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s>&#34;base64&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=s>&#34;Content-Disposition&#34;</span><span class=p>:</span>       <span class=p>{</span><span class=s>&#34;attachment; filename=\&#34; &#34;</span> <span class=o>+</span> <span class=nx>subject</span> <span class=o>+</span> <span class=s>&#34;.xlsx\&#34;&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=nx>encoder</span> <span class=o>:=</span> <span class=nx>base64</span><span class=p>.</span><span class=nf>NewEncoder</span><span class=p>(</span><span class=nx>base64</span><span class=p>.</span><span class=nx>StdEncoding</span><span class=p>,</span> <span class=nx>part</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>encoder</span><span class=p>.</span><span class=nf>Write</span><span class=p>(</span><span class=nx>attachment</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>encoder</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>writer</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>b</span><span class=p>.</span><span class=nf>Bytes</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>因为需要支持 抄送和密送，所以传入的时候要加上<code>header.Set("Cc", strings.Join(cc, ", "))</code></p><p>附件的<code>Content-Type</code>不确定的话，可以使用<code>writer := multipart.NewWriter(body)</code>来获取合适的类型</p><p>然后使用<code>smtp</code>发送邮件</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>sendEmail</span><span class=p>(</span><span class=nx>to</span><span class=p>,</span> <span class=nx>cc</span><span class=p>,</span> <span class=nx>bcc</span> <span class=p>[]</span><span class=kt>string</span><span class=p>,</span> <span class=nx>emailContent</span> <span class=p>[]</span><span class=kt>byte</span><span class=p>)</span> <span class=kt>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 配置 SMTP 服务器信息
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>smtpHost</span> <span class=o>:=</span> <span class=s>&#34;smtp.xx.com&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>smtpPort</span> <span class=o>:=</span> <span class=s>&#34;465&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>smtpUsername</span> <span class=o>:=</span> <span class=s>&#34;user@user.com&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>smtpPassword</span> <span class=o>:=</span> <span class=s>&#34;xxxxxxxxxx&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>from</span> <span class=o>:=</span> <span class=nx>smtpUsername</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// 发送邮件
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// 设置 TLS 配置
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>tlsConfig</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>tls</span><span class=p>.</span><span class=nx>Config</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>ServerName</span><span class=p>:</span> <span class=nx>smtpHost</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// 建立 TLS 连接
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>conn</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>tls</span><span class=p>.</span><span class=nf>Dial</span><span class=p>(</span><span class=s>&#34;tcp&#34;</span><span class=p>,</span> <span class=nx>smtpHost</span><span class=o>+</span><span class=s>&#34;:&#34;</span><span class=o>+</span><span class=nx>smtpPort</span><span class=p>,</span> <span class=nx>tlsConfig</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;failed to create TLS connection: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// 创建 SMTP 客户端
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>client</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>smtp</span><span class=p>.</span><span class=nf>NewClient</span><span class=p>(</span><span class=nx>conn</span><span class=p>,</span> <span class=nx>smtpHost</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;failed to create SMTP client: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>client</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// 认证
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>auth</span> <span class=o>:=</span> <span class=nx>smtp</span><span class=p>.</span><span class=nf>PlainAuth</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>,</span> <span class=nx>smtpUsername</span><span class=p>,</span> <span class=nx>smtpPassword</span><span class=p>,</span> <span class=nx>smtpHost</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=p>=</span> <span class=nx>client</span><span class=p>.</span><span class=nf>Auth</span><span class=p>(</span><span class=nx>auth</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;failed to authenticate: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// 设置发件人和收件人
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>if</span> <span class=nx>err</span> <span class=p>=</span> <span class=nx>client</span><span class=p>.</span><span class=nf>Mail</span><span class=p>(</span><span class=nx>from</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;failed to set sender: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// 设置所有收件人（包括 To、Cc 和 Bcc）
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>recipients</span> <span class=o>:=</span> <span class=nb>append</span><span class=p>(</span><span class=nb>append</span><span class=p>(</span><span class=nx>to</span><span class=p>,</span> <span class=nx>cc</span><span class=o>...</span><span class=p>),</span> <span class=nx>bcc</span><span class=o>...</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>recipient</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>recipients</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=p>=</span> <span class=nx>client</span><span class=p>.</span><span class=nf>Rcpt</span><span class=p>(</span><span class=nx>recipient</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;failed to add recipient %s: %v&#34;</span><span class=p>,</span> <span class=nx>recipient</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// 发送邮件内容
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>writer</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>client</span><span class=p>.</span><span class=nf>Data</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;failed to create data writer: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>_</span><span class=p>,</span> <span class=nx>err</span> <span class=p>=</span> <span class=nx>writer</span><span class=p>.</span><span class=nf>Write</span><span class=p>(</span><span class=nx>emailContent</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;failed to write email content: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>err</span> <span class=p>=</span> <span class=nx>writer</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;failed to close data writer: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>client</span><span class=p>.</span><span class=nf>Quit</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>这里有一个问题，就是需要配置TLS，然后将上一步构建的邮件内容添加上就行</p><p>然后再说保存，如果需要在其他客户端查看自动发送的记录，就需要<code>imap</code>协议登录邮箱后，单独保存到指定的邮箱目录中</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>saveToSentFolder</span><span class=p>(</span><span class=nx>emailContent</span> <span class=p>[]</span><span class=kt>byte</span><span class=p>)</span> <span class=kt>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 连接到 IMAP 服务器
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>imapAddr</span> <span class=o>:=</span> <span class=s>&#34;imap.xxx.com:993&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>client</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>imapclient</span><span class=p>.</span><span class=nf>DialTLS</span><span class=p>(</span><span class=nx>imapAddr</span><span class=p>,</span> <span class=kc>nil</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>client</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// 登录
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>client</span><span class=p>.</span><span class=nf>Login</span><span class=p>(</span><span class=s>&#34;user@user.com&#34;</span><span class=p>,</span> <span class=s>&#34;xxxxxxxxx&#34;</span><span class=p>).</span><span class=nf>Wait</span><span class=p>();</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>mailboxes</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>client</span><span class=p>.</span><span class=nf>List</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>,</span> <span class=s>&#34;%&#34;</span><span class=p>,</span> <span class=kc>nil</span><span class=p>).</span><span class=nf>Collect</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>log</span><span class=p>.</span><span class=nf>Fatalf</span><span class=p>(</span><span class=s>&#34;failed to list mailboxes: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>log</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Found %v mailboxes&#34;</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=nx>mailboxes</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>mbox</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>mailboxes</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>log</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34; - %v&#34;</span><span class=p>,</span> <span class=nx>mbox</span><span class=p>.</span><span class=nx>Mailbox</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// 使用 APPEND 命令保存邮件
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>size</span> <span class=o>:=</span> <span class=nb>int64</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=nx>emailContent</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=nx>appendCmd</span> <span class=o>:=</span> <span class=nx>client</span><span class=p>.</span><span class=nf>Append</span><span class=p>(</span><span class=s>&#34;Sent Messages&#34;</span><span class=p>,</span> <span class=nx>size</span><span class=p>,</span> <span class=kc>nil</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>appendCmd</span><span class=p>.</span><span class=nf>Write</span><span class=p>(</span><span class=nx>emailContent</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>log</span><span class=p>.</span><span class=nf>Fatalf</span><span class=p>(</span><span class=s>&#34;failed to write message: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>appendCmd</span><span class=p>.</span><span class=nf>Close</span><span class=p>();</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>log</span><span class=p>.</span><span class=nf>Fatalf</span><span class=p>(</span><span class=s>&#34;failed to close message: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>appendCmd</span><span class=p>.</span><span class=nf>Wait</span><span class=p>();</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>log</span><span class=p>.</span><span class=nf>Fatalf</span><span class=p>(</span><span class=s>&#34;APPEND command failed: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>到此，基本的需求已经搞定了，剩下就是根据读取的配置目录和文件，进行发送就行</p></div><div class=row><div class=col-md-8><div class=mb-5><div class="li-x div-x post-meta"><li class=pr-0><a href=https://desdemo.top/tags/><i class="fas fa-tags"></i></a></li><div class=tags-sm><li><a href=https://desdemo.top/tags/go role=button>go</a></li></div></div></div></div></div><div class="row pt-3"><div class=col-md-6><a href=https://desdemo.top/blog/2024-04/gitactions%E6%9E%84%E5%BB%BA%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E4%BA%8C/ class=post-meta>Previous<div class="pt-2 pb-5 d-flex"><i class="fas fa-angle-left text-grey font-weight-bold mr-2 active-color"></i>
<span>Gitactions构建前后端项目二</span></div></a></div><div class="col-md-6 text-right"></div></div></div></div><div class="col-md-2 pl-0"><div id=page-scrollspy class=toc-nav><ul class="nav nav-pills ml-0"><li class="nav-item pb-3 text-center"><span class="font-weight-bold mb-2">- CATALOG -</span></li><ul class=nav><li class=nav-item><a class=nav-link href=#%e5%ae%89%e8%a3%85>安装</a></li></ul><ul class=nav><li class=nav-item><a class=nav-link href=#%e8%bf%90%e8%a1%8c>运行</a></li></ul><ul class=nav><li class=nav-item><a class=nav-link href=#%e9%9c%80%e6%b1%82%e7%be%a4%e5%8f%91%e9%82%ae%e7%ae%b1>需求:群发邮箱</a></li></ul></ul></div></div></div></main><footer class="page-footer text-center font-small mt-4 wow fadeIn"><div class="pb-2 mt-5 pt-5"><a href=//github.com/desdemo target=_blank rel="noopener me"><i class="fab fa-github pr-1" aria-hidden=true></i></a>
<a href=mailto:guodesdemo@gmail.com><i class="far fa-envelope-open pr-1" aria-hidden=true></i></a></div><div class="copyright py-4"><span>2016 - 2024 &copy; | Theme <a href=https://github.com/EliiseS/AllinOne target=_blank>AllinOne</a></span></div></footer><script type=text/javascript src=https://desdemo.top/js/vendors/jquery/jquery-3.3.1.min.js></script><script type=text/javascript src=https://desdemo.top/js/vendors/jquery/jquery.smooth-scroll.min.js></script><script type=text/javascript src=https://desdemo.top/js/vendors/popper.min.js></script><script type=text/javascript src=https://desdemo.top/js/vendors/holder.min.js></script><script type=text/javascript src=https://desdemo.top/js/vendors-extensions/bootstrap4/bootstrap.min.js></script><script type=text/javascript src=https://desdemo.top/js/vendors/mdb/mdb.min.js></script><script type=text/javascript src=https://desdemo.top/js/main.js></script><script src=https://desdemo.top/js/vendors/highlight.pack.js></script><script>hljs.initHighlightingOnLoad()</script><script src=https://desdemo.top/js/vendors/katex/katex.min.js></script><script src=https://desdemo.top/js/vendors/katex/contrib/auto-render.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body)})</script><script type=text/javascript>(new WOW).init()</script></body></html>