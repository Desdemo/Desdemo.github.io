<!doctype html><html lang=zn-Hans><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge, chrome=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no,maximum-scale=1"><meta name=author content="Desdemo"><meta name=description content="github actions构建记录"><meta property="og:title" content="GithubActions构建前后端项目"><meta property="og:description" content="github actions构建记录"><meta property="og:type" content="article"><meta property="og:url" content="https://desdemo.top/blog/2024-04/githubactions%E6%9E%84%E5%BB%BA%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2024-04-11T15:05:48+08:00"><meta property="article:modified_time" content="2024-04-11T15:05:48+08:00"><title>GithubActions构建前后端项目 | Desdemo
</title><link rel=canonical href=https://desdemo.top/blog/2024-04/githubactions%E6%9E%84%E5%BB%BA%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE/><link href=https://desdemo.top/vendors/fontawesome-free-5.14.0-web/css/all.min.css rel=stylesheet><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Ubuntu+Mono:400,400i,700,700i|Raleway:300,400,500,600"><link href=https://desdemo.top/css/font.css rel=stylesheet><link href=https://desdemo.top/css/vendors/bootstrap4/bootstrap.min.css rel=stylesheet><link href=https://desdemo.top/css/vendors-extensions/mdb/mdb.min.css rel=stylesheet><link href=https://desdemo.top/css/vendors/mdb/style.min.css rel=stylesheet><link href=https://desdemo.top/css/main.css rel=stylesheet><link rel="shortcut icon" href=https://desdemo.top/image/logo.png><style type=text/css>@media(min-width:800px) and (max-width:850px){.navbar:not(.top-nav-collapse){background:#1c2331!important}}</style><link rel=stylesheet href=https://desdemo.top/js/vendors/katex/katex.min.css><link rel=stylesheet href=https://desdemo.top/css/vendors/highlight/github-gist.css></head><body class=bg-light data-spy=scroll data-target=#page-scrollspy data-offset=90><nav class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class=container><a class=navbar-brand href=https://desdemo.top><img class=avatar src=https://desdemo.top/image/logo.png style=width:40px!important;height:auto class="d-inline-block align-top" alt>
<strong>Desdemo</strong>
</a><button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=https://desdemo.top>Home</a></li><li class=nav-item><a class=nav-link href=https://desdemo.top/blog/>Blog</a></li><li class=nav-item><a class=nav-link href=https://desdemo.top/moment/>Moment</a></li><li class=nav-item><a class=nav-link href=https://desdemo.top/about/>About</a></li></ul></div></div></nav><div id=site-header class="carousel slide carousel-fade" data-ride=carousel style=height:18rem><div class=carousel-inner role=listbox><div class="carousel-item active"><div class=view style=background-image:url(https://desdemo.top/image/header-slides/20210228110118.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div><div class=carousel-item><div class=view style=background-image:url(https://desdemo.top/image/header-slides//%e5%be%ae%e4%bf%a1%e5%9b%be%e7%89%87_20210901164615-min.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div><div class=carousel-item><div class=view style=background-image:url(https://desdemo.top/image/header-slides//%e5%be%ae%e4%bf%a1%e5%9b%be%e7%89%87_20210901164624%20%281%29.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div><div class=carousel-item><div class=view style=background-image:url(https://desdemo.top/image/header-slides//%e5%be%ae%e4%bf%a1%e5%9b%be%e7%89%87_20210901164643-min.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div><div class=carousel-item><div class=view style=background-image:url(https://desdemo.top/image/header-slides//%e5%be%ae%e4%bf%a1%e5%9b%be%e7%89%87_20210901164655.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div><div class=carousel-item><div class=view style=background-image:url(https://desdemo.top/image/header-slides//%e5%be%ae%e4%bf%a1%e5%9b%be%e7%89%87_20230221150156.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div><div class=carousel-item><div class=view style=background-image:url(https://desdemo.top/image/header-slides//%e5%be%ae%e4%bf%a1%e5%9b%be%e7%89%87_202302211501561.jpg);background-repeat:no-repeat;background-size:cover><div class="mask rgba-black-light d-flex justify-content-center align-items-center"></div></div></div></div><div class="carousel-content text-center white-text wow fadeIn"><div class="row mx-0 headfont mt-3 pt-4"><div class="col-12 col-sm-5 align-middle"><a href=https://desdemo.top><img class="pull-right avatar avatar-md" src=https://desdemo.top/image/pro.jpg alt></a></div><div class="col-12 col-sm-7 text-left pl-2"><a href=https://desdemo.top><h1 class="mb-2 h1" style=font-weight:300><strong>Desdemo</strong></h1></a><div class=mt-2 style=font-size:1rem;color:#fff><a href=//github.com/desdemo target=_blank rel="noopener me"><i class="fab fa-github pr-1" aria-hidden=true></i></a>
<a href=mailto:guodesdemo@gmail.com><i class="far fa-envelope-open pr-1" aria-hidden=true></i></a></div></div></div></div></div><main class=post-main-wrapper><div class=row><div class=col-md-10><div class="z-depth-1 post-wrapper white-bg single-post dont-break-out"><div class="post-header text-center"><ul class="post-meta li-x"><li><a href=https://desdemo.top/categories/%E6%8A%80%E6%9C%AF><i class="fas fa-folder-open pr-1" aria-hidden=true></i> 技术</a></li><li><a href=https://desdemo.top/series/%E5%A4%87%E5%BF%98%E5%BD%95><i class="fas fa-bookmark pr-1" aria-hidden=true></i>备忘录</a></li></ul><div class="px-4 post-heading">GithubActions构建前后端项目</div><ul class="post-meta li-x mt-1"><li>Apr 11, 2024</li><li class=middot></li><li>2 minute read</li></ul></div><div class="post-content markdown"><h1 id=github-actions-构建项目记录>Github Actions 构建项目记录</h1><h2 id=前端项目>前端项目</h2><p>一般都是vue或者react， 构建的话 都是 <code>npm install</code> <code>npm run build</code></p><p>首先 设置仓库环境变量</p><img src=https://cdn.desdemo.top/img/image-20240411165026704.png alt=image-20240411165026704 style=zoom:67%><p>然后就是整理 workflows/xxx.yaml 的执行流程</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Deploy to Server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>master </span><span class=w> </span><span class=c># 修改成你的主分支名称</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Checkout code</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Install dependencies and build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          npm install --force  # 这里假设你的项目是基于 npm 的
</span></span></span><span class=line><span class=cl><span class=sd>          npm run build  # 根据你的项目配置打包命令</span><span class=w>          
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Deploy to server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>easingthemes/ssh-deploy@main</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>SSH_PRIVATE_KEY</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.SSH_PRIVATE_KEY }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>SOURCE</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;dist/&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>REMOTE_HOST</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.REMOTE_HOST }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>REMOTE_USER</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.REMOTE_USER }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>TARGET</span><span class=p>:</span><span class=w> </span><span class=l>/opt/xxx/sssxxx      </span><span class=w>
</span></span></span></code></pre></div><p>修改之后，查看actions的执行情况</p><p><img src=https://cdn.desdemo.top/img/image-20240411170033465.png alt=image-20240411170033465></p><h2 id=后端dockerfile构建打包推送更新>后端Dockerfile构建打包推送更新</h2><p>后端用的golang项目，项目也很简单，所以直接网上抄了个构建示例</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=c>###############################################################################</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>#          使用第一个镜像打包</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>###############################################################################</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> golang:latest as builder</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> CGO_ENABLED <span class=m>0</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> GOPROXY https://goproxy.cn,direct<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># 设置固定的打包路径</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /build</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ADD</span> go.mod .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> go mod download<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> . .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># CGO_ENABLED禁用cgo 然后指定OS等，并go build</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> go mod tidy<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># 依赖 CGO, 修改: CGO_ENABLED=1 GOOS=linux GOARCH=amd64 go build -ldflags &#39;-extldflags &#34;-static&#34;&#39; -o main main.go</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> <span class=nv>CGO_ENABLED</span><span class=o>=</span><span class=m>0</span> <span class=nv>GOOS</span><span class=o>=</span>linux <span class=nv>GOARCH</span><span class=o>=</span>amd64 go build -ldflags<span class=o>=</span><span class=s2>&#34;-s -w&#34;</span> -o runner main.go<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>###############################################################################</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>#          运行镜像: 从构建镜像中复制构建好的文件</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>###############################################################################</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># 使用空镜像 scratch</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># FROM scratch</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> alpine</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># 如果使用 scratch 镜像, 把 RUN 相关的全部移除掉</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>###############################################################################</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># 使用国内 alpine 源</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> <span class=nb>echo</span> https://mirrors.aliyun.com/alpine/v3.8/main/ &gt; /etc/apk/repositories<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># 设置系统时区 - +8时区</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> apk update <span class=o>&amp;&amp;</span> apk add tzdata bash<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> rm -rf /etc/localtime <span class=o>&amp;&amp;</span> cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> <span class=nb>echo</span> <span class=s2>&#34;Asia/Shanghai&#34;</span> &gt; /etc/timezone<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># 设置固定的项目路径</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> WORKDIR /app<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># 添加应用可执行文件，并设置执行权限</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>builder /build/runner <span class=nv>$WORKDIR</span>/runner<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># 添加I18N多语言文件、静态文件、配置文件、模板文件</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>builder /build/resource     <span class=nv>$WORKDIR</span>/resource<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>builder /build/con.yaml   <span class=nv>$WORKDIR</span>/con.yaml<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># 指定暴露端口, 如果有的话</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 8808</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>###############################################################################</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>#                                   运行</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>###############################################################################</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> $WORKDIR</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;./runner&#34;</span><span class=p>]</span><span class=err>
</span></span></span></code></pre></div><p>然后本地构建镜像没问题之后，进行推送</p><p>我用的腾讯云免费的个人镜像仓库</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>docker build -t runner:latest .
</span></span><span class=line><span class=cl>docker login ccr.ccs.tencentyun.com --username<span class=o>=</span>xxxxxx
</span></span><span class=line><span class=cl>docker tag runner:latest  ccr.ccs.tencentyun.com/xxxx/runner:latest
</span></span><span class=line><span class=cl>docker push ccr.ccs.tencentyun.com/xxxx/runner:latest
</span></span><span class=line><span class=cl><span class=c1># 登录服务器  拉取</span>
</span></span><span class=line><span class=cl>docker pull ccr.ccs.tencentyun.com/xxxxx/runner:latest
</span></span><span class=line><span class=cl><span class=c1># 启动</span>
</span></span><span class=line><span class=cl>docker run -d  --name bus  -p 8808:8808 ccr.ccs.tencentyun.com/xxxx/runner:latest
</span></span></code></pre></div><p>成功之后，接下来就非常简单了，就是把这些操作转移到github actions上</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># This is a basic workflow to help you get started with Actions</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>build docker image</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Controls when the action will run.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>main</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Allows you to run this workflow manually from the Actions tab</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 可以手动触发</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>workflow_dispatch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>inputs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>logLevel</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Log level&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>required</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>default</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;warning&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>tags</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Test scenario tags&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>buildx</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Checkout</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Get current date</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>date</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;::set-output name=today::$(date +&#39;%Y-%m-%d_%H-%M&#39;)&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Set up QEMU</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>docker/setup-qemu-action@v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Set up Docker Buildx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>buildx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>docker/setup-buildx-action@v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Available platforms</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>echo ${{ steps.buildx.outputs.platforms }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Login to Registry</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>docker/login-action@v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>registry</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.REGISTRY_URL }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>username</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.REGISTRY_USERNAME }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>password</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.REGISTRY_TOKEN }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Build and push</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>docker/build-push-action@v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=l>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>file</span><span class=p>:</span><span class=w> </span><span class=l>./Dockerfile</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=c># 所需要的体系结构，可以在 Available platforms 步骤中获取所有的可用架构</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>platforms</span><span class=p>:</span><span class=w> </span><span class=l>linux/amd64,linux/arm64/v8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=c># 镜像推送时间</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>push</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=c># 给清单打上多个标签</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>tags</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>            ccr.ccs.tencentyun.com/xxxxx/runner:${{ steps.date.outputs.today }}
</span></span></span><span class=line><span class=cl><span class=sd>            ccr.ccs.tencentyun.com/xxxxx/runner:latest</span><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Docker Pull</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>appleboy/ssh-action@master</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.REMOTE_HOST }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>username</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.REMOTE_USER }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.SSH_PRIVATE_KEY }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>docker pull ccr.ccs.tencentyun.com/xxxxxx/runner:latest &amp;&amp; docker restart bus</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          
</span></span></span></code></pre></div><p>最后大功告成</p><p><img src=https://cdn.desdemo.top/img/image-20240411165929371.png alt=image-20240411165929371></p><p>唯一美中不足的是，后端的构建时间太久了，有时间再优化吧</p></div><div class=row><div class=col-md-8><div class=mb-5><div class="li-x div-x post-meta"><li class=pr-0><a href=https://desdemo.top/tags/><i class="fas fa-tags"></i></a></li><div class=tags-sm><li><a href=https://desdemo.top/tags/ci/cd role=button>CI/CD</a></li></div></div></div></div></div><div class="row pt-3"><div class=col-md-6><a href=https://desdemo.top/blog/2024-04/seaweedfs%E4%BD%BF%E7%94%A8/ class=post-meta>Previous<div class="pt-2 pb-5 d-flex"><i class="fas fa-angle-left text-grey font-weight-bold mr-2 active-color"></i>
<span>SeaweedFs使用</span></div></a></div><div class="col-md-6 text-right"><a href=https://desdemo.top/blog/2024-04/gitactions%E6%9E%84%E5%BB%BA%E5%89%8D%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E4%BA%8C/ class=post-meta>Next<div class="pt-2 pb-5 flex-reverse"><i class="fas fa-angle-right text-grey font-weight-bold ml-2 active-color"></i>
<span>Gitactions构建前后端项目二</span></div></a></div></div></div></div><div class="col-md-2 pl-0"><div id=page-scrollspy class=toc-nav><ul class="nav nav-pills ml-0"><li class="nav-item pb-3 text-center"><span class="font-weight-bold mb-2">- CATALOG -</span></li><ul class=nav><li class=nav-item><a class=nav-link href=#github-actions-%e6%9e%84%e5%bb%ba%e9%a1%b9%e7%9b%ae%e8%ae%b0%e5%bd%95>Github Actions 构建项目记录</a></li></ul><ul class=nav><ul class=nav><li class=nav-item><a class=nav-link href=#%e5%89%8d%e7%ab%af%e9%a1%b9%e7%9b%ae>前端项目</a></li></ul></ul><ul class=nav><ul class=nav><li class=nav-item><a class=nav-link href=#%e5%90%8e%e7%ab%afdockerfile%e6%9e%84%e5%bb%ba%e6%89%93%e5%8c%85%e6%8e%a8%e9%80%81%e6%9b%b4%e6%96%b0>后端Dockerfile构建打包推送更新</a></li></ul></ul></ul></div></div></div></main><footer class="page-footer text-center font-small mt-4 wow fadeIn"><div class="pb-2 mt-5 pt-5"><a href=//github.com/desdemo target=_blank rel="noopener me"><i class="fab fa-github pr-1" aria-hidden=true></i></a>
<a href=mailto:guodesdemo@gmail.com><i class="far fa-envelope-open pr-1" aria-hidden=true></i></a></div><div class="copyright py-4"><span>2016 - 2024 &copy; | Theme <a href=https://github.com/EliiseS/AllinOne target=_blank>AllinOne</a></span></div></footer><script type=text/javascript src=https://desdemo.top/js/vendors/jquery/jquery-3.3.1.min.js></script><script type=text/javascript src=https://desdemo.top/js/vendors/jquery/jquery.smooth-scroll.min.js></script><script type=text/javascript src=https://desdemo.top/js/vendors/popper.min.js></script><script type=text/javascript src=https://desdemo.top/js/vendors/holder.min.js></script><script type=text/javascript src=https://desdemo.top/js/vendors-extensions/bootstrap4/bootstrap.min.js></script><script type=text/javascript src=https://desdemo.top/js/vendors/mdb/mdb.min.js></script><script type=text/javascript src=https://desdemo.top/js/main.js></script><script src=https://desdemo.top/js/vendors/highlight.pack.js></script><script>hljs.initHighlightingOnLoad()</script><script src=https://desdemo.top/js/vendors/katex/katex.min.js></script><script src=https://desdemo.top/js/vendors/katex/contrib/auto-render.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body)})</script><script type=text/javascript>(new WOW).init()</script></body></html>